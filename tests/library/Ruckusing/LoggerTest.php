<?php
/**
 * Generated by PHPUnit_SkeletonGenerator on 2012-01-18 at 08:22:54.
 */
class Ruckusing_LoggerTest extends PHPUnit_Framework_TestCase
{
    /**
     * @var Ruckusing_Logger
     */
    protected $object;

    /**
     * @var string
     */
    protected $_filename;

    public function __construct()
    {
        $this->_filename = RUCKUSING_BASE . '/tests/logs/tests.log';
    }

    /**
     * Sets up the fixture, for example, opens a network connection.
     * This method is called before a test is executed.
     */
    protected function setUp()
    {
        $this->object = Ruckusing_Logger::instance($this->_filename);
    }

    /**
     * Tears down the fixture, for example, closes a network connection.
     * This method is called after a test is executed.
     */
    protected function tearDown()
    {
    }

    public function testInstance()
    {
        $logger = Ruckusing_Logger::instance($this->_filename);
        $this->assertSame($this->object, $logger);
        $logger = Ruckusing_Logger::instance('/tmp/test_logger2.log');
        $this->assertSame($this->object, $logger);
    }

    public function testDestruct()
    {
        $this->object->__destruct();
    }

    public function testSetPriority()
    {
        $msg = 'msg de test debug without define priority, by default all';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[DEBUG\] '.$msg.'$/';
        $this->object->debug($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);

        $this->object->setPriority(Ruckusing_Logger::ERROR);
        $msg = 'msg de test warn with priority err';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[WARN\] '.$msg.'$/';
        $this->object->warn($msg);
        $file = file($this->_filename);
        $this->assertNotRegExp($expected, $file[count($file)-1]);

        $this->object->setPriority(Ruckusing_Logger::WARNING);
        $msg = 'msg de test err with priority warn';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[ERR\] '.$msg.'$/';
        $this->object->err($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
        $msg = 'msg de test warn with priority warn';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[WARN\] '.$msg.'$/';
        $this->object->warn($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
        $msg = 'msg de test info with priority warn';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[INFO\] '.$msg.'$/';
        $this->object->info($msg);
        $file = file($this->_filename);
        $this->assertNotRegExp($expected, $file[count($file)-1]);

        $this->object->setPriority(Ruckusing_Logger::INFO);
        $msg = 'msg de test err with priority info';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[ERR\] '.$msg.'$/';
        $this->object->err($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
        $msg = 'msg de test warn with priority info';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[WARN\] '.$msg.'$/';
        $this->object->warn($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
        $msg = 'msg de test info with priority info';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[INFO\] '.$msg.'$/';
        $this->object->info($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
        $msg = 'msg de test debug with priority info';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[DEBUG\] '.$msg.'$/';
        $this->object->debug($msg);
        $file = file($this->_filename);
        $this->assertNotRegExp($expected, $file[count($file)-1]);

        $this->object->setPriority(Ruckusing_Logger::DEBUG);
        $msg = 'msg de test err with priority debug';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[ERR\] '.$msg.'$/';
        $this->object->err($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
        $msg = 'msg de test warn with priority debug';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[WARN\] '.$msg.'$/';
        $this->object->warn($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
        $msg = 'msg de test info with priority debug';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[INFO\] '.$msg.'$/';
        $this->object->info($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
        $msg = 'msg de test debug with priority debug';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[DEBUG\] '.$msg.'$/';
        $this->object->debug($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);

        $this->object->setPriority(Ruckusing_Logger::DEBUG);
    }

    public function testDebug()
    {
        $msg = 'msg de test';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[DEBUG\] '.$msg.'$/';
        $this->object->debug($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
    }

    public function testInfo()
    {
        $msg = 'msg de test';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[INFO\] '.$msg.'$/';
        $this->object->info($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
    }

    public function testWarn()
    {
        $msg = 'msg de test';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[WARN\] '.$msg.'$/';
        $this->object->warn($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
    }

    public function testErr()
    {
        $msg = 'msg de test';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[ERR\] '.$msg.'$/';
        $this->object->err($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
    }

    public function testLog()
    {
        $msg = 'msg de test';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[INFO\] '.$msg.'$/';
        $this->object->log($msg);
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
        $msg = 'msg de test 2';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[DEBUG\] '.$msg.'$/';
        $this->object->log($msg, 'debug');
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
        $msg = 'msg de test 3';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[WARN\] '.$msg.'$/';
        $this->object->log($msg, 'warn');
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
        $msg = 'msg de test 4';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[ERR\] '.$msg.'$/';
        $this->object->log($msg, 'err');
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
        $msg = 'msg de test 5';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[UNKNOWN\] '.$msg.'$/';
        $this->object->log($msg, 'unknown');
        $file = file($this->_filename);
        $this->assertRegExp($expected, $file[count($file)-1]);
    }

    public function testClose()
    {
        $this->object->close();
        $msg = 'msg de test 6';
        $expected = '/^\w+ \d+ \d+:\d+:\d+ \[UNKNOWN\] '.$msg.'$/';
        $this->object->log($msg, 'unknown');
        $file = file($this->_filename);
        $this->assertNotRegExp($expected, $file[count($file)-1]);
    }
}
