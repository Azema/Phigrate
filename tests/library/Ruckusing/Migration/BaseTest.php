<?php
/**
 * Generated by PHPUnit_SkeletonGenerator on 2012-01-15 at 19:12:10.
 *
 * @group Ruckusing_Migration
 */
class Ruckusing_Migration_BaseTest extends PHPUnit_Framework_TestCase
{
    /**
     * @var Ruckusing_Migration_Base
     */
    protected $object;

    /**
     * @var adapterMock
     */
    protected $_adapter;

    public function __construct()
    {
        $this->_adapter = new migrationAdapterMock(array(), '');
    }

    /**
     * Sets up the fixture, for example, opens a network connection.
     * This method is called before a test is executed.
     */
    protected function setUp()
    {
        parent::setUp();
        $this->object = new migrationMock($this->_adapter);
    }

    /**
     * Tears down the fixture, for example, closes a network connection.
     * This method is called after a test is executed.
     */
    protected function tearDown()
    {
        $this->object = null;
        parent::tearDown();
    }

    public function testConstructor()
    {
        try {
            new migrationMock('wrong adapter');
            $this->fail('Adapter not implement Ruckusing_Adapter_Base');
        } catch (Ruckusing_Exception_Argument $e) {
            $msg = 'adapter must be implement Ruckusing_Adapter_Base!';
            $this->assertEquals($msg, $e->getMessage());
        }
        $migrationBase = new migrationMock($this->_adapter);
        $this->assertInstanceOf('Ruckusing_Migration_Base', $migrationBase);
    }

    /**
     * @covers Ruckusing_Migration_Base::setAdapter
     */
    public function testSetAdapter()
    {
        $adapter = 'wrong adapter';
        try {
            $this->object->setAdapter($adapter);
            $this->fail('argument not implement Ruckusing_Adapter_Base');
        } catch (Ruckusing_Exception_Argument $e) {
            $msg = 'adapter must be implement Ruckusing_Adapter_Base!';
            $this->assertEquals($msg, $e->getMessage());
        }
        $actual = $this->object->setAdapter($this->_adapter);
        $this->assertInstanceOf('Ruckusing_Migration_Base', $actual);
    }

    /**
     * @covers Ruckusing_Migration_Base::getAdapter
     */
    public function testGetAdapter()
    {
        $actual = $this->object->getAdapter();
        $this->assertInstanceOf('Ruckusing_Adapter_Base', $actual);
    }

    /**
     * @covers Ruckusing_Migration_Base::createDatabase
     */
    public function testCreateDatabase()
    {
        $name = 'migration_test';
        $options = array('NAMES utf8');
        $return = $this->object->createDatabase($name, $options);
        $this->assertTrue($return);
        $this->assertEquals($name, $this->_adapter->datas['createDatabase']['name']);
        $this->assertEquals($options, $this->_adapter->datas['createDatabase']['options']);
    }

    /**
     * @covers Ruckusing_Migration_Base::dropDatabase
     */
    public function testDropDatabase()
    {
        $name = 'migration_test';
        $return = $this->object->dropDatabase($name);
        $this->assertTrue($return);
        $this->assertEquals($name, $this->_adapter->datas['dropDatabase']['name']);
    }

    /**
     * @covers Ruckusing_Migration_Base::createTable
     */
    public function testCreateTable()
    {
        $name = 'users';
        $options = array('NAMES utf8');
        $table = $this->object->createTable($name, $options);
        $this->assertInstanceOf('Ruckusing_Adapter_TableDefinition', $table);
        $this->assertEquals($name, $this->_adapter->datas['createTable']['name']);
        $this->assertEquals($options, $this->_adapter->datas['createTable']['options']);
    }

    /**
     * @covers Ruckusing_Migration_Base::dropTable
     */
    public function testDropTable()
    {
        $name = 'users';
        $return = $this->object->dropTable($name);
        $this->assertTrue($return);
        $this->assertEquals($name, $this->_adapter->datas['dropTable']['name']);
    }

    /**
     * @covers Ruckusing_Migration_Base::renameTable
     */
    public function testRenameTable()
    {
        $name = 'users';
        $newName = 'new_users';
        $return = $this->object->renameTable($name, $newName);
        $this->assertTrue($return);
        $this->assertEquals($name, $this->_adapter->datas['renameTable']['name']);
        $this->assertEquals($newName, $this->_adapter->datas['renameTable']['newName']);
    }

    /**
     * @covers Ruckusing_Migration_Base::addColumn
     */
    public function testAddColumn()
    {
        $tableName = 'users';
        $columnName = 'firstname';
        $type = 'string';
        $options = array('null' => false);
        $return = $this->object->addColumn($tableName, $columnName, $type, $options);
        $this->assertTrue($return);
        $this->assertEquals($tableName, $this->_adapter->datas['addColumn']['tableName']);
        $this->assertEquals($columnName, $this->_adapter->datas['addColumn']['columnName']);
        $this->assertEquals($type, $this->_adapter->datas['addColumn']['type']);
        $this->assertEquals($options, $this->_adapter->datas['addColumn']['options']);
    }

    /**
     * @covers Ruckusing_Migration_Base::removeColumn
     */
    public function testRemoveColumn()
    {
        $tableName = 'users';
        $columnName = 'civility';
        $return = $this->object->removeColumn($tableName, $columnName);
        $this->assertTrue($return);
        $this->assertEquals($tableName, $this->_adapter->datas['removeColumn']['tableName']);
        $this->assertEquals($columnName, $this->_adapter->datas['removeColumn']['columnName']);
    }

    /**
     * @covers Ruckusing_Migration_Base::changeColumn
     */
    public function testChangeColumn()
    {
        $tableName = 'users';
        $columnName = 'login';
        $type = 'string';
        $options = array('null' => false, 'limit' => 25);
        $return = $this->object->changeColumn($tableName, $columnName, $type, $options);
        $this->assertTrue($return);
        $this->assertEquals($tableName, $this->_adapter->datas['changeColumn']['tableName']);
        $this->assertEquals($columnName, $this->_adapter->datas['changeColumn']['columnName']);
        $this->assertEquals($type, $this->_adapter->datas['changeColumn']['type']);
        $this->assertEquals($options, $this->_adapter->datas['changeColumn']['options']);
    }

    /**
     * @covers Ruckusing_Migration_Base::renameColumn
     */
    public function testRenameColumn()
    {
        $tableName = 'users';
        $columnName = 'login';
        $newColumnName = 'pseudo';
        $return = $this->object->renameColumn($tableName, $columnName, $newColumnName);
        $this->assertTrue($return);
        $this->assertEquals($tableName, $this->_adapter->datas['renameColumn']['tableName']);
        $this->assertEquals($columnName, $this->_adapter->datas['renameColumn']['columnName']);
        $this->assertEquals($newColumnName, $this->_adapter->datas['renameColumn']['newColumnName']);
    }

    /**
     * @covers Ruckusing_Migration_Base::addIndex
     */
    public function testAddIndex()
    {
        $tableName = 'users';
        $columnName = 'login';
        $options = array('unique' => true);
        $return = $this->object->addIndex($tableName, $columnName, $options);
        $this->assertTrue($return);
        $this->assertEquals($tableName, $this->_adapter->datas['addIndex']['tableName']);
        $this->assertEquals($columnName, $this->_adapter->datas['addIndex']['columnName']);
        $this->assertEquals($options, $this->_adapter->datas['addIndex']['options']);
    }

    /**
     * @covers Ruckusing_Migration_Base::removeIndex
     */
    public function testRemoveIndex()
    {
        $tableName = 'users';
        $columnName = 'login';
        $options = array('unique' => true);
        $return = $this->object->removeIndex($tableName, $columnName, $options);
        $this->assertTrue($return);
        $this->assertEquals($tableName, $this->_adapter->datas['removeIndex']['tableName']);
        $this->assertEquals($columnName, $this->_adapter->datas['removeIndex']['columnName']);
        $this->assertEquals($options, $this->_adapter->datas['removeIndex']['options']);
    }

    /**
     * @covers Ruckusing_Migration_Base::execute
     */
    public function testExecute()
    {
        $query = 'SHOW DATABASES;';
        $return = $this->object->execute($query);
        $this->assertTrue($return);
        $this->assertEquals($query, $this->_adapter->datas['execute']['query']);
    }

    /**
     * @covers Ruckusing_Migration_Base::selectOne
     */
    public function testSelectOne()
    {
        $query = 'SELECT name FROM `users` LIMIT 1;';
        $return = $this->object->selectOne($query);
        $expected = array('name' => 'resultOne');
        $this->assertEquals($query, $this->_adapter->datas['selectOne']['query']);
        $this->assertEquals($expected, $return);
    }

    /**
     * @covers Ruckusing_Migration_Base::selectAll
     */
    public function testSelectAll()
    {
        $query = 'SELECT name FROM `users`;';
        $return = $this->object->selectAll($query);
        $expected = array(
            array('name' => 'resultAll'),
            array('name' => 'second'),
        );
        $this->assertEquals($query, $this->_adapter->datas['selectAll']['query']);
        $this->assertEquals($expected, $return);
    }

    /**
     * @covers Ruckusing_Migration_Base::query
     */
    public function testQuery()
    {
        $query = 'SHOW DATABASES;';
        $return = $this->object->query($query);
        $this->assertTrue($return);
        $this->assertEquals($query, $this->_adapter->datas['execute']['query']);
    }

    /**
     * @covers Ruckusing_Migration_Base::quote
     */
    public function testQuote()
    {
        $value = 'I test "quoted" string';
        $return = $this->object->quote($value);
        $expected = '\'I test \"quoted\" string\'';
        $this->assertEquals($value, $this->_adapter->datas['quote']['value']);
        $this->assertEquals($expected, $return);
    }
}
