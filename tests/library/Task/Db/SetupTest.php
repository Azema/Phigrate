<?php
/**
 * Generated by PHPUnit_SkeletonGenerator on 2012-01-20 at 08:34:50.
 *
 * @Task_Db
 */
class Task_Db_SetupTest extends PHPUnit_Framework_TestCase
{
    /**
     * @var Task_Db_Setup
     */
    protected $object;

    /**
     * @var adapterMock
     */
    protected $_adapter;

    public function __construct()
    {
        $this->_adapter = new adapterTaskMock(array(), '');
    }

    /**
     * Sets up the fixture, for example, opens a network connection.
     * This method is called before a test is executed.
     */
    protected function setUp()
    {
        parent::setUp();
        $this->object = new Task_Db_Setup($this->_adapter);
    }

    /**
     * Tears down the fixture, for example, closes a network connection.
     * This method is called after a test is executed.
     */
    protected function tearDown()
    {
        $this->object = null;
        parent::tearDown();
    }

    public function testExecuteWithTableSchema()
    {
        $this->_adapter->setTableSchemaExist(true);
        $actual = $this->object->execute(array());
        $regexp = '/^Started: \d{4}-\d{2}-\d{2} \d{1,2}:\d{2}(am|pm) \w{3}\012+'
            . "\[db:setup\]: \012+\t+NOTICE: table 'schema_migrations' already exists\."
            . ' Nothing to do\.\012+Finished: '
            . '\d{4}-\d{2}-\d{2} \d{1,2}:\d{2}(am|pm) \w{3}\012+$/';
        $this->assertNotEmpty($actual);
        $this->assertRegExp($regexp, $actual);
    }

    public function testExecuteWithoutTableSchema()
    {
        $this->_adapter->setTableSchemaExist(false);
        $actual = $this->object->execute(array());
        $regexp = '/^Started: \d{4}-\d{2}-\d{2} \d{1,2}:\d{2}(am|pm) \w{3}\012+'
            . "\[db:setup\]: \012+\t+Creating table: 'schema_migrations'"
            . '\012+\t+Done\.\012+Finished: '
            . '\d{4}-\d{2}-\d{2} \d{1,2}:\d{2}(am|pm) \w{3}\012+$/';
        $this->assertNotEmpty($actual);
        $this->assertRegExp($regexp, $actual);
    }

    public function testHelp()
    {
        $expected =<<<USAGE
Task: \033[36mdb:setup\033[0m

A basic task to initialize your DB for migrations is available. One should 
always run this task when first starting out.

This task not take arguments.

USAGE;
        $actual = $this->object->help();
        $this->assertEquals($expected, $actual);
    }
}
